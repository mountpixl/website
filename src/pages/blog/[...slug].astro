---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const formattedDate = new Date(post.data.date).toLocaleDateString('en-CA', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const schema = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: post.data.title,
  description: post.data.description,
  datePublished: post.data.date.toISOString(),
  author: {
    '@type': 'Person',
    name: post.data.author,
  },
  publisher: {
    '@type': 'Organization',
    name: 'Mount Pixl',
    url: 'https://mountpixl.com',
  },
};
---

<BaseLayout
  title={post.data.title}
  description={post.data.description}
  schema={schema}
>
  <article class="py-20 lg:py-28">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Header -->
      <div class="mb-10">
        <a href="/blog" class="inline-flex items-center gap-1 text-sm text-forest hover:text-gold transition-colors mb-6">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to blog
        </a>
        <div class="flex items-center gap-3 mb-4">
          <span class="px-2.5 py-0.5 bg-forest/10 text-forest text-xs font-medium rounded-full">{post.data.category}</span>
          <time class="text-xs text-gray-400">{formattedDate}</time>
        </div>
        <h1 class="font-heading text-3xl sm:text-4xl font-bold text-deep-green mb-4 leading-tight">
          {post.data.title}
        </h1>
        <p class="text-gray-600 text-lg leading-relaxed">{post.data.description}</p>
      </div>

      <!-- Content -->
      <div class="prose prose-gray max-w-none text-gray-700 leading-relaxed [&_h2]:font-heading [&_h2]:text-2xl [&_h2]:font-bold [&_h2]:text-deep-green [&_h2]:mt-12 [&_h2]:mb-4 [&_h3]:font-heading [&_h3]:text-lg [&_h3]:font-semibold [&_h3]:text-deep-green [&_h3]:mt-8 [&_h3]:mb-3 [&_p]:mb-4 [&_ul]:space-y-2 [&_ul]:list-disc [&_ul]:pl-5 [&_ol]:space-y-2 [&_ol]:list-decimal [&_ol]:pl-5 [&_li]:text-gray-600 [&_strong]:text-deep-green [&_a]:text-forest [&_a:hover]:text-gold [&_blockquote]:border-l-4 [&_blockquote]:border-gold [&_blockquote]:pl-4 [&_blockquote]:italic [&_blockquote]:text-gray-500 [&_code]:bg-gray-100 [&_code]:px-1.5 [&_code]:py-0.5 [&_code]:rounded [&_code]:text-sm [&_code]:text-forest [&_pre]:bg-gray-900 [&_pre]:text-gray-100 [&_pre]:rounded-xl [&_pre]:p-6 [&_pre]:overflow-x-auto [&_pre_code]:bg-transparent [&_pre_code]:p-0">
        <Content />
      </div>

      <!-- CTA -->
      <div class="mt-16 bg-gradient-to-br from-forest to-deep-green rounded-2xl p-8 text-center">
        <h3 class="font-heading text-xl font-bold text-white mb-3">
          Want help implementing these ideas?
        </h3>
        <p class="text-gray-300 text-sm mb-5 max-w-lg mx-auto">
          Book a free consultation and we'll show you how to apply these strategies to your specific business.
        </p>
        <a
          href="/contact"
          class="inline-flex items-center gap-2 px-6 py-3 bg-gold hover:bg-gold-dark text-deep-green font-semibold rounded-lg transition-all hover:shadow-lg text-sm"
        >
          Book a Free Consultation
        </a>
      </div>
    </div>
  </article>
</BaseLayout>
